(function($){$(document).ready(function(){var container=document.querySelector('.events-widget');var nextBtn=container.querySelector('.timeline-next');var prevBtn=container.querySelector('.timeline-prev');var currentData;var allEvents;var slideWidth=16;var isMobile=$(window).width()<1007;var mobileDiff=112;var transformLeft=isMobile?-(mobileDiff):0;var timerId=null;var visibleCount=isMobile?49:63;var yearIndex;var categoryIndex=0;var moveTransformLeft=null;function createCategories(data){var html='';data.forEach(function(category,i,arr){html+='<option class="'+category.color+'">'+category.title+'</option>'});$('#event-type',container).html(html).trigger('chosen:updated');}function createYears(data){var html='';data.forEach(function(year,i,arr){var active=i==data.length-1?' active':'';html+='<a style="position:absolute; left:'+i*750+'px; pointer-events: none; cursor: default;" class="tag tag-light'+active+'" data-id="'+i+'">'+year+'</a>';});container.querySelector('.event-years').innerHTML=html;}function setCurrentData(){currentData=[];for(var i=0;i<allEvents.length;i++){currentData=currentData.concat(allEvents[i][categoryIndex].items)}container.querySelector('h1').innerHTML=allEvents[yearIndex][categoryIndex].title;createTimeline();}function createTimeline(){var firstEventId=null;var html='<ul id="timelinePane">';html=addEmptyLines(31,html);for(var i=0;i<currentData.length;i++){var item=currentData[i];if(i%2){html+='<li ><span id="havi" style="z-index:3" class="no-green" data-id="'+i+'" data-year="'+item.year+'" data-category="'+item.category+'">'+item.date+'</span><i></i></li>';}else{html+='<li ><span class="hei no-green" data-id="'+i+'" data-year="'+item.year+'" data-category="'+item.category+'">'+item.date+'</span><i></i></li>';}html=addEmptyLines(9,html);if(firstEventId==null&&item.year==yearIndex){firstEventId=i;}}html=addEmptyLines(31,html);html+='</ul>';container.querySelector('.timeline-carousel').innerHTML=html;transformLeft=isMobile?-(mobileDiff+firstEventId*slideWidth*10):-(firstEventId*slideWidth*10);changeTimeline(transformLeft);showEvent(firstEventId);}function addEmptyLines(num,html){for(var i=1;i<=num;i++){html+='<li><i></i></li>'}return html;}function getCenter(position){var firstLeftEq=Math.abs(position)/slideWidth;return document.querySelectorAll('.timeline-carousel li')[Math.round(firstLeftEq)+Math.ceil(visibleCount/2-0.5)]}function linesOpacity(position){var center=getCenter(position);var oldCenter=document.querySelector('.real-center');if(oldCenter)oldCenter.className='';center.className='real-center';center.style.opacity=1;var count=Math.ceil(visibleCount/2-0.5);var leftItem=center.previousElementSibling;var rightItem=center.nextElementSibling;for(var i=0;i<count;i++){var opacity=((count-i)/count).toFixed(2);leftItem.style.opacity=1;rightItem.style.opacity=1;switch(i){case 0:break;case 1:break;case 2:break;default:break;}leftItem=leftItem.previousElementSibling;rightItem=rightItem.nextElementSibling;}}function viidiaPrevFunction(id){var start=id*70;var finish=(id-1)*70;console.log(finish+' '+start);var timerId=setInterval(function(){start=start-1;$(".event .event-info .event-years").css('left','-'+start+'px');if(start==finish){clearTimeout(timerId);}},20);}function showEvent(id){id=id||0;var event=currentData[id];var year=$('.event-years a.active',container).text();var category=$('#event-type option:selected',container).val();var group=$('[data-year='+yearIndex+']');var groupId=0;group.each(function(index){if($(this).is('[data-id='+id+']')){groupId=index;$(".event .event-info .event-years").css('left','-'+id*70+'px');$('.events-widget').css('background-image','url('+timeLineData['events'][yearIndex][0]['items'][index]['url']+')','background-size','100%','background-repeat','no-repeat');}});var preview=event.preview;var title=event.title;var period=event.period;var url=event.url;document.getElementById('eventPreview').innerHTML=preview;document.getElementById('eventTitle').innerHTML=title;document.getElementById('eventPeriod').innerHTML=period;document.getElementById('eventLink').href=url;}function changeTimeline(position){if(isArea(position)){document.getElementById('timelinePane').style['-webkit-transform']='translateX('+Math.floor(position)+'px) translateZ(0)';document.getElementById('timelinePane').style['-moz-transform']='translateX('+Math.floor(position)+'px) translateZ(0)';document.getElementById('timelinePane').style['-ms-transform']='translateX('+Math.floor(position)+'px) translateZ(0)';document.getElementById('timelinePane').style['transform']='translateX('+Math.floor(position)+'px) translateZ(0)';linesOpacity(position);}}function isArea(position){var length=(currentData.length-1)*slideWidth*10;var startPosition=isMobile?-mobileDiff:0;var endPosition=startPosition-length;return position<=startPosition&&position>=endPosition;}function stepChangeTimeline(direction,steps){steps=steps||slideWidth*10;var originSteps=steps;var coef=steps>=160?(steps>=320?20:10):5;steps=steps/coef;if(!timerId){var step=0;if((direction=='right'&&isArea(transformLeft-originSteps))||(direction=='left'&&isArea(transformLeft+originSteps))){container.querySelector('.timeline .event').style.opacity=1;}else{return false;}timerId=setTimeout(function change(){var position=transformLeft;if(direction=='right'){position=transformLeft-(step*coef);$(".event .event-info .event-years").css('left','-'+position+'px');1}else if(direction=='left')position=transformLeft+(step*coef);changeTimeline(position);step++;if(step>steps){clearTimeout(timerId);timerId=null;transformLeft=position;var centerData=container.querySelector('.real-center span').dataset;if(parseInt(centerData.year)!=yearIndex){container.querySelector('.event-years a.active').classList.remove('active');container.querySelector('.tag[data-id="'+centerData.year+'"]').classList.add('active');yearIndex=parseInt(centerData.year);changeBlockOpacity(0.1);setTimeout(function(){container.querySelector('h1').innerHTML=allEvents[yearIndex][categoryIndex].title;changeBlockOpacity(1);},200);}showEvent(centerData.id);container.querySelector('.timeline .event').style.opacity=1;}else{setTimeout(change,0)}},0);}}function registerEvents(){$('.timeline-carousel',container).on('click touchstart','span',function(e){e.preventDefault();e.stopPropagation();if(!timerId){var position=$(this).data('id')*10*slideWidth;if(isMobile)position+=mobileDiff;var absTransformLeft=Math.abs(transformLeft);if(absTransformLeft!=position){var direction=absTransformLeft<position?'right':'left';var steps=Math.abs(absTransformLeft-position);stepChangeTimeline(direction,steps);}}}).on('mousedown','span',function(e){e.preventDefault();e.stopPropagation();})
nextBtn.onclick=function(){stepChangeTimeline('right');};prevBtn.onclick=function(){stepChangeTimeline('left');};var yearBtns=container.querySelectorAll('.event-years a');for(var i=0;i<yearBtns.length;i++){yearBtns[i].addEventListener('click',function(){container.querySelector('.event-years a.active').classList.remove('active');this.classList.add('active');yearIndex=parseInt(this.dataset.id);var nextIndex=container.querySelector('span[data-year="'+yearIndex+'"]').dataset.id;var currentIndex=container.querySelector('.real-center span').dataset.id;var steps=Math.abs((nextIndex-currentIndex)*slideWidth*10);transformLeft=nextIndex<currentIndex?transformLeft+steps:transformLeft-steps;changeBlockOpacity(0.1);setTimeout(function(){container.querySelector('h1').innerHTML=allEvents[yearIndex][categoryIndex].title;changeTimeline(transformLeft);changeBlockOpacity(1);},500);});}$('#event-type',container).chosen().change(function(e){var className=$('option:selected',this)[0].className;$(this).next().attr('data-color',className);categoryIndex=$('option:selected',this).index();changeBlockOpacity(0.1);setTimeout(function(){setCurrentData();changeBlockOpacity(1);},500)});}function changeBlockOpacity(opacity){container.querySelector('.events-widget h1').style.opacity=opacity;container.querySelector('.timeline .event').style.opacity=opacity;container.querySelector('.timeline-carousel-wrap').style.opacity=opacity;}function init(){allEvents=timeLineData.events;yearIndex=timeLineData.years.length-1;createCategories(timeLineData.categories);createYears(timeLineData.years,allEvents.length);setCurrentData();registerEvents();}$(window).resize(function(e){if($(window).width()<1007){if(!isMobile){transformLeft=transformLeft-mobileDiff;isMobile=true;}}else{if(isMobile){transformLeft=transformLeft+mobileDiff;isMobile=false;}}visibleCount=isMobile?49:63;changeTimeline(transformLeft);});init();});(function($){$(function(){var infographicsBlock=$('.infographics');var currentYear=null;var infograficsData=null;var titleBlock=$('#infographicsTitle',infographicsBlock);var infographicsCarousel=$('.infographics-carousel',infographicsBlock).on('jcarousel:reloadend jcarousel:reload jcarousel:create',function(){var carousel=$(this);carousel.jcarousel('items').css('width',Math.ceil(carousel.innerWidth())+'px');}).on('jcarousel:animate',function(event,carousel){titleBlock.css('opacity',0);}).on('jcarousel:targetin','li',function(event,carousel){var self=$(this);setTimeout(function(){titleBlock.html(self.data('title'))},320)}).on('jcarousel:animateend',function(event,carousel){titleBlock.css('opacity',1);}).hover(function(){$(this).jcarouselAutoscroll('stop');},function(){$(this).jcarouselAutoscroll('start');}).jcarousel({wrap:'circular',animation:'slow'}).jcarouselAutoscroll({interval:4000,target:'+=1',autostart:true}).jcarouselSwipe();$('.infographics-prev',infographicsBlock).jcarouselControl({target:'-=1'});$('.infographics-next',infographicsBlock).jcarouselControl({target:'+=1'});$('.years',infographicsBlock).on('click','a',function(){$('.years a',infographicsBlock).removeClass('active');$(this).addClass('active');currentYear=infograficsData[$(this).data('id')];titleBlock.css('opacity',0);infographicsCarousel.css('opacity',0);infographicsCarousel.jcarouselAutoscroll('stop');infographicsCarousel.html(renderSlider()).jcarousel('reload');setTimeout(function(){titleBlock.html(currentYear.data[0].title);titleBlock.css('opacity',1);infographicsCarousel.css('opacity',1);infographicsCarousel.jcarouselAutoscroll('start');},400);return false;});if($(window).width()<1007){infographicsCarousel.jcarouselAutoscroll('stop');}else{infographicsCarousel.jcarouselAutoscroll('start');}$(window).resize(function(e){if($(window).width()<1007){infographicsCarousel.jcarouselAutoscroll('stop');}else{infographicsCarousel.jcarouselAutoscroll('start');}});});})(jQuery);})(jQuery);